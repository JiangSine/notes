# Java性能权威指南
---

## 1. 导论
本书主要着眼于两个方面：
- 如何利用JVM自身的性能进行调优， 也可以说如何通过配置JVM来影响程序的各种性能指标。
- 理解Java平台的特性对性能的影响。


**JVM调优标志**
除了少数标志，JVM主要接受两类标志：
1. 布尔标志：-XX:+flagName表示开启， -XX:-flagName表示关闭
2. 带有参数的标志：-XX：flagName=something,表示flagName的值为something.

自动优化:JVM自身会基于环境对标志进行自动调优。

### 1.1全面的性能调优
**算法**
提高性能，算法是重中之重。
**编写更少的代码**
代码量的增多，代表启动时间的增加，代表创建和销毁的对象变多，代表GC的工作量越大，GC的周期越长。

而且，这是一个积少成多的问题。而且很难修复。

**过早优化**
高德纳的名言：
> 不应该话大量的时间耗费在很小的性能提升上。过早优化是所有噩梦的根源。

这句话是说，我们应该编写 **清晰、直接、易读、易理解** 的代码。

但是，优化本身不属于过早优化的层次，当你知道有不同的解决方案，其中一种更加优秀的时候，这是优化，不是过早优化。

**外部环境**
可能外部环境才是瓶颈，是的，我是说数据库。
水桶效应永远适用于有依赖的应用。

### 1.2常见的优化

1. 借助性能分析来优化代码。终点关注耗时的操作。
2. 新代码比起机器配置更可能引起性能问题，机器配置比操作系统或者JVM的bug问题。
3. 为应用最常用的操作编写简单的算法。

## 2. 性能测试

### 2.1 测试真实应用
**微基准测试** 是用来测试微笑代码单元的性能。
但是测试起来很困难。主要是JVM的优化带来的问题。
1. 如果测试结果不被使用，编译器可能会去除计算。实际上，把局部变量变成实例变量并用volatile修饰是更好而办法。
2. 多线程下，有可能更多的时间被花在竞争资源上。
3. 多次执行，可能会被编译器发现并且优化掉。
4. 输入合理的参数，不合理的参数，会导致测试结果答非所问。

除此之外，还要注意的是编译效应，编译器在编译方法时， 会根据代码的性能分析反馈来决定最佳优化策略：频繁调用的方法，调用的栈的深度，方法参数的实际类型。

**宏基准测试** 测试的是应用本身，以及用到的所有资源。
测试的是当前的环境下，了解一个应用的性能。
不进行整体的测试，就不会了解那部分的优化会产生最大的回报。


### 2.2 理解批处理流失时间，吞吐量和响应时间
JIT的存在，让代码的循环执行，不再可以简单的测试。
JVM回花点时间全面优化代码，让其以最高的性能执行。

> 程序热身
> 应用的热身，指的是，在应用实际运行中，会有很多的缓存在工作，他们共同促进的程序快速的运行。



## 3. Java性能调优工具箱

### 3.1 操作系统的工具和分析
监控的是CPU,内存，磁盘的使用，偶尔需要监控的是网络。

**CPU**
性能调优的目的是，让CPU在最短时间内使用率尽可能高。

CPU空闲的原因：
1. 同步原语阻塞，等待锁的释放。
2. 等待某些东西，比如数据库的响应。
3. 的确是无所事事。

**磁盘使用率**
- 如果磁盘正在做大量的I/O操作，那么I/O很容易就会成为瓶颈。
- 监控系统是不是正在做内存交换。

### 3.2 Java监控工具
...


## JIT编译器
